"use strict";
/*
*                      Copyright 2023 Salto Labs Ltd.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with
* the License.  You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
exports.__esModule = true;
exports.getFetchTargets = exports.isMetadataTypeWithDependency = exports.isMetadataTypeWithoutDependencies = exports.METADATA_TYPE_TO_DEPENDENCIES = exports.SALESFORCE_METADATA_TYPES = exports.SUPPORTED_METADATA_TYPES = exports.EXCLUDED_METADATA_TYPES = exports.METADATA_TYPES_WITH_DEPENDENCIES = exports.METADATA_TYPES_WITHOUT_DEPENDENCIES = exports.WORKFLOW_FIELDS = exports.CUSTOM_OBJECT_FIELDS = exports.FOLDER_METADATA_TYPES = void 0;
var lodash_1 = require("lodash");
exports.FOLDER_METADATA_TYPES = [
    'ReportFolder',
    'DashboardFolder',
    'DocumentFolder',
    'EmailFolder',
];
exports.CUSTOM_OBJECT_FIELDS = [
    'WebLink',
    'ValidationRule',
    'BusinessProcess',
    'RecordType',
    'ListView',
    'FieldSet',
    'CompactLayout',
    'SharingReason',
    'Index',
];
exports.WORKFLOW_FIELDS = [
    'WorkflowAlert',
    'WorkflowFieldUpdate',
    'WorkflowFlowAction',
    'WorkflowOutboundMessage',
    'WorkflowKnowledgePublish',
    'WorkflowTask',
    'WorkflowRule',
];
exports.METADATA_TYPES_WITHOUT_DEPENDENCIES = [
    'AIApplication',
    'AIApplicationConfig',
    'AccessMapping',
    'AccountSharingRuleSettings',
    'ActionLinkGroupTemplate',
    'ActionLinkTemplate',
    'ActionOverride',
    'AnalyticSnapshot',
    'AnalyticSnapshotMapping',
    'AnalyticsCloudComponentLayoutItem',
    'AnimationRule',
    'ApexClass',
    'ApexComponent',
    'ApexEmailNotification',
    'ApexEmailNotifications',
    'ApexPage',
    'ApexTestSuite',
    'ApexTrigger',
    'AppActionOverride',
    'AppBrand',
    'AppComponentList',
    'AppMenu',
    'AppMenuItem',
    'AppPreferences',
    'AppProfileActionOverride',
    'AppSettings',
    'AppWorkspaceConfig',
    'AppointmentAssignmentPolicy',
    'AppointmentSchedulingPolicy',
    'ApprovalAction',
    'ApprovalEntryCriteria',
    'ApprovalPageField',
    'ApprovalProcess',
    'ApprovalStep',
    'ApprovalStepApprover',
    'ApprovalStepRejectBehavior',
    'ApprovalSubmitter',
    'Approver',
    'ArticleTypeChannelDisplay',
    'ArticleTypeTemplate',
    'AssignmentRules',
    'Attachment',
    'AuraDefinition',
    'AuraDefinitionBundle',
    'AuraDefinitions',
    'AuthProvider',
    'AutoResponseRule',
    'AutoResponseRules',
    'BlacklistedConsumer',
    'BrandingSet',
    'BrandingSetProperty',
    'BriefcaseDefinition',
    'BriefcaseRule',
    'BriefcaseRuleFilter',
    'CallCenter',
    'CallCenterItem',
    'CallCenterRoutingMap',
    'CallCenterSection',
    'CallCoachingMediaProvider',
    'CanvasMetadata',
    'Capabilities',
    'Certificate',
    'ChannelLayout',
    'ChannelLayoutItem',
    'ChartSummary',
    'ChatterAnswersReputationLevel',
    'ChatterExtension',
    'CleanDataService',
    'CleanRule',
    'Community',
    'ComponentInstance',
    'ComponentInstanceProperty',
    'ComponentInstancePropertyList',
    'ComponentInstancePropertyListItem',
    'ConnectedApp',
    'ConnectedAppAttribute',
    'ConnectedAppCanvasConfig',
    'ConnectedAppIpRange',
    'ConnectedAppMobileDetailConfig',
    'ConnectedAppOauthAssetToken',
    'ConnectedAppOauthConfig',
    'ConnectedAppOauthIdToken',
    'ConnectedAppOauthPolicy',
    'ConnectedAppSamlConfig',
    'ConnectedAppSessionPolicy',
    'ContactCenterChannel',
    'Container',
    'ContentAsset',
    'ContentAssetLink',
    'ContentAssetRelationships',
    'ContentAssetVersion',
    'ContentAssetVersions',
    'ConversationVendorInfo',
    'CorsWhitelistOrigin',
    'CspTrustedSite',
    'CustomApplication',
    'CustomApplicationComponent',
    'CustomConsoleComponents',
    'CustomFeedFilter',
    'CustomFieldTranslation',
    'CustomHelpMenuItem',
    'CustomHelpMenuSection',
    'CustomHttpHeader',
    'CustomLabels',
    'CustomMetadataValue',
    'CustomNotificationType',
    'CustomObject',
    'CustomObjectTranslation',
    'CustomPageWebLink',
    'CustomPermission',
    'CustomPermissionDependencyRequired',
    'CustomShortcut',
    'CustomSite',
    'CustomTab',
    'CustomValue',
    'Dashboard',
    'DashboardComponent',
    'DashboardComponentColumn',
    'DashboardComponentGroupingSort',
    'DashboardComponentGroupingSortProperties',
    'DashboardComponentSection',
    'DashboardComponentSortInfo',
    'DashboardDynamicValue',
    'DashboardFilter',
    'DashboardFilterColumn',
    'DashboardFilterOption',
    'DashboardFlexTableComponentProperties',
    'DashboardGridComponent',
    'DashboardGridLayout',
    'DashboardTableColumn',
    'DataCategory',
    'DataCategoryGroup',
    'DefaultShortcut',
    'DelegateGroup',
    'Document',
    'DuplicateRule',
    'DuplicateRuleFilter',
    'DuplicateRuleFilterItem',
    'DuplicateRuleMatchRule',
    'EclairGeoData',
    'EclairMap',
    'EmailTemplate',
    'EmailServicesAddress',
    'EmailServicesFunction',
    'EmbeddedServiceAppointmentSettings',
    'EmbeddedServiceBranding',
    'EmbeddedServiceConfig',
    'EmbeddedServiceCustomComponent',
    'EmbeddedServiceCustomLabel',
    'EmbeddedServiceCustomization',
    'EmbeddedServiceFlow',
    'EmbeddedServiceFlowConfig',
    'EmbeddedServiceLayout',
    'EmbeddedServiceLayoutRule',
    'EmbeddedServiceMenuItem',
    'EmbeddedServiceMenuSettings',
    'EmbeddedServiceResource',
    'EnrichedField',
    'EntitlementProcess',
    'EntitlementProcessMilestoneItem',
    'EntitlementProcessMilestoneTimeTrigger',
    'EntitlementTemplate',
    'EntityImplements',
    'EscalationAction',
    'EscalationRules',
    'ExternalCredential',
    'ExternalCredentialParameter',
    'ExternalDataSource',
    'ExternalDataSrcDescriptor',
    'ExternalServiceOperation',
    'ExternalServiceRegistration',
    'FeedFilterCriterion',
    'FeedLayout',
    'FeedLayoutComponent',
    'FeedLayoutFilter',
    'FieldImplements',
    'FieldInstance',
    'FieldInstanceProperty',
    'FieldMapping',
    'FieldMappingField',
    'FieldMappingRow',
    'FieldOverride',
    'FieldRestrictionRule',
    'FieldSetItem',
    'FieldSetTranslation',
    'FlexiPageEvent',
    'FlexiPageEventPropertyMapping',
    'FlexiPageEventSourceProperty',
    'FlexiPageEventTarget',
    'FlexiPageEventTargetProperty',
    'Flow',
    'FlowActionCall',
    'FlowActionCallInputParameter',
    'FlowActionCallOutputParameter',
    'FlowApexPluginCall',
    'FlowApexPluginCallInputParameter',
    'FlowApexPluginCallOutputParameter',
    'FlowAssignment',
    'FlowAssignmentItem',
    'FlowCategory',
    'FlowCategoryItems',
    'FlowChoice',
    'FlowChoiceUserInput',
    'FlowCollectionMapItem',
    'FlowCollectionProcessor',
    'FlowCollectionSortOption',
    'FlowCondition',
    'FlowConnector',
    'FlowConstant',
    'FlowDataTypeMapping',
    'FlowDecision',
    'FlowDynamicChoiceSet',
    'FlowElementReferenceOrValue',
    'FlowFormula',
    'FlowInputFieldAssignment',
    'FlowInputValidationRule',
    'FlowLoop',
    'FlowMetadataValue',
    'FlowOrchestratedStage',
    'FlowOutputFieldAssignment',
    'FlowRecordCreate',
    'FlowRecordDelete',
    'FlowRecordFilter',
    'FlowRecordLookup',
    'FlowRecordRollback',
    'FlowRecordUpdate',
    'FlowRule',
    'FlowSchedule',
    'FlowScheduledPath',
    'FlowScreen',
    'FlowScreenField',
    'FlowScreenFieldInputParameter',
    'FlowScreenFieldOutputParameter',
    'FlowScreenRule',
    'FlowScreenRuleAction',
    'FlowStage',
    'FlowStageStep',
    'FlowStageStepAssignee',
    'FlowStageStepEntryActionInputParameter',
    'FlowStageStepEntryActionOutputParameter',
    'FlowStageStepExitActionInputParameter',
    'FlowStageStepExitActionOutputParameter',
    'FlowStageStepInputParameter',
    'FlowStageStepOutputParameter',
    'FlowStart',
    'FlowStep',
    'FlowSubflow',
    'FlowSubflowInputAssignment',
    'FlowSubflowOutputAssignment',
    'FlowTest',
    'FlowTestAssertion',
    'FlowTestCondition',
    'FlowTestParameter',
    'FlowTestPoint',
    'FlowTestReferenceOrValue',
    'FlowTextTemplate',
    'FlowVariable',
    'FlowVisibilityRule',
    'FlowWait',
    'FlowWaitEvent',
    'FlowWaitEventInputParameter',
    'FlowWaitEventOutputParameter',
    'FolderShare',
    'GatewayProviderPaymentMethodType',
    'GlobalValueSet',
    'GlobalValueSetTranslation',
    'Group',
    'HistoryRetentionPolicy',
    'HomePageComponent',
    'HomePageLayout',
    'IPAddressRange',
    'IdeaReputationLevel',
    'IfExpression',
    'IframeWhiteListUrl',
    'IframeWhiteListUrlSettings',
    'InboundNetworkConnProperty',
    'InboundNetworkConnection',
    'IndexField',
    'InstalledPackage',
    'ItemInstance',
    'KeyboardShortcuts',
    'Layout',
    'LayoutColumn',
    'LayoutItem',
    'LayoutSection',
    'LayoutSectionTranslation',
    'LayoutTranslation',
    'LeadConvertSettings',
    'Letterhead',
    'LetterheadHeaderFooter',
    'LetterheadLine',
    'LightningBolt',
    'LightningBoltFeatures',
    'LightningBoltImages',
    'LightningBoltItems',
    'LightningComponentBundle',
    'LightningExperienceTheme',
    'LightningMessageChannel',
    'LightningMessageField',
    'LightningOnboardingConfig',
    'LightningPage',
    'LightningPageRegion',
    'LightningPageTemplateInstance',
    'ListPlacement',
    'ListViewFilter',
    'LiveAgentConfig',
    'LiveChatSensitiveDataRule',
    'LoginFlow',
    'LookupFilterTranslation',
    'LwcResource',
    'LwcResources',
    'MLDataDefinition',
    'MLField',
    'MLFilter',
    'MLPredictionDefinition',
    'MLRecommendationDefinition',
    'ManagedContentNodeType',
    'ManagedContentType',
    'MapExpression',
    'MatchingRule',
    'MatchingRuleItem',
    'MatchingRules',
    'MilestoneType',
    'MiniLayout',
    'MktDataLakeAttributes',
    'MktDataLakeFieldAttributes',
    'MktDataModelAttributes',
    'MktDataModelFieldAttributes',
    'MobileApplicationDetail',
    'MutingPermissionSet',
    'MyDomainDiscoverableLogin',
    'NamedCredential',
    'NamedCredentialParameter',
    'NetworkBranding',
    'NextAutomatedApprover',
    'NotificationChannels',
    'NotificationTypeConfig',
    'NotificationTypeSettings',
    'OauthCustomScope',
    'OauthCustomScopeApp',
    'ObjectMapping',
    'ObjectMappingField',
    'ObjectNameCaseValue',
    'ObjectRelationship',
    'ObjectUsage',
    'OutboundNetworkConnProperty',
    'OutboundNetworkConnection',
    'PackageVersion',
    'PathAssistant',
    'PathAssistantStep',
    'PaymentGatewayProvider',
    'PermissionSet',
    'PermissionSetApexClassAccess',
    'PermissionSetApexPageAccess',
    'PermissionSetApplicationVisibility',
    'PermissionSetCustomMetadataTypeAccess',
    'PermissionSetCustomPermissions',
    'PermissionSetCustomSettingAccess',
    'PermissionSetCustomSettingAccesses',
    'PermissionSetExternalDataSourceAccess',
    'PermissionSetFieldPermissions',
    'PermissionSetFlowAccess',
    'PermissionSetGroup',
    'PermissionSetObjectPermissions',
    'PermissionSetRecordTypeVisibility',
    'PermissionSetTabSetting',
    'PermissionSetUserPermission',
    'PicklistValue',
    'PicklistValueTranslation',
    'PlatformActionList',
    'PlatformActionListItem',
    'PlatformCachePartition',
    'PlatformCachePartitionType',
    'PlatformEventChannel',
    'PlatformEventChannelMember',
    'PlatformEventSubscriberConfig',
    'PostTemplate',
    'PrimaryTabComponents',
    'ProductAttributeSet',
    'ProductAttributeSetItem',
    'Profile',
    'ProfileActionOverride',
    'ProfileApexClassAccess',
    'ProfileApexPageAccess',
    'ProfileApplicationVisibility',
    'ProfileCategoryGroupVisibility',
    'ProfileCustomMetadataTypeAccess',
    'ProfileCustomPermissions',
    'ProfileCustomSettingAccess',
    'ProfileExternalDataSourceAccess',
    'ProfileFieldLevelSecurity',
    'ProfileFlowAccess',
    'ProfileLayoutAssignment',
    'ProfileLoginHours',
    'ProfileLoginIpRange',
    'ProfileObjectPermissions',
    'ProfilePasswordPolicy',
    'ProfileRecordTypeVisibility',
    'ProfileSearchLayouts',
    'ProfileSessionSetting',
    'ProfileTabVisibility',
    'ProfileUserPermission',
    'Prompt',
    'PromptVersion',
    'PublicGroups',
    'PushNotification',
    'Queue',
    'QueueMembers',
    'QueueSobject',
    'QuickAction',
    'QuickActionLayout',
    'QuickActionLayoutColumn',
    'QuickActionLayoutItem',
    'QuickActionList',
    'QuickActionListItem',
    'QuickActionSendEmailOptions',
    'QuickActionTranslation',
    'RecommendationConditionValue',
    'RecommendationLoadCondition',
    'RecommendationStrategy',
    'RecordActionDefaultItem',
    'RecordActionDeployment',
    'RecordActionDeploymentChannel',
    'RecordActionDeploymentContext',
    'RecordActionRecommendation',
    'RecordActionSelectableItem',
    'RecordTypePicklistValue',
    'RecordTypeTranslation',
    'RedirectWhitelistUrl',
    'RelatedContent',
    'RelatedContentItem',
    'RelatedList',
    'RelatedListItem',
    'RemoteSiteSetting',
    'Report',
    'ReportAggregate',
    'ReportAggregateReference',
    'ReportBlockInfo',
    'ReportBucketField',
    'ReportBucketFieldSourceValue',
    'ReportBucketFieldValue',
    'ReportChart',
    'ReportChartComponentLayoutItem',
    'ReportColorRange',
    'ReportColumn',
    'ReportCrossFilter',
    'ReportCustomDetailFormula',
    'ReportDataCategoryFilter',
    'ReportFilter',
    'ReportFilterItem',
    'ReportFormattingRule',
    'ReportFormattingRuleValue',
    'ReportGrouping',
    'ReportHistoricalSelector',
    'ReportLayoutSection',
    'ReportParam',
    'ReportTimeFrameFilter',
    'ReportType',
    'ReportTypeColumn',
    'ReputationLevels',
    'RestrictionRule',
    'Role',
    'RoleAndSubordinates',
    'RoleAndSubordinatesInternal',
    'Roles',
    'RuleEntry',
    'SamlSsoConfig',
    'Scontrol',
    'SearchLayouts',
    'ServiceCloudConsoleConfig',
    'SharedTo',
    'SharingCriteriaRule',
    'SharingGuestRule',
    'SharingOwnerRule',
    'SharingReasonTranslation',
    'SharingRecalculation',
    'SharingRules',
    'SharingSet',
    'SharingTerritoryRule',
    'SidebarComponent',
    'SiteDotCom',
    'SiteIframeWhiteListUrl',
    'SiteRedirectMapping',
    'SiteWebAddress',
    'Skill',
    'SkillAssignments',
    'SkillProfileAssignments',
    'SkillUserAssignments',
    'StandardFieldTranslation',
    'StandardValue',
    'StandardValueSet',
    'StandardValueSetTranslation',
    'StaticResource',
    'StrategyAction',
    'StrategyActionArg',
    'StrategyNodeExclusive',
    'StrategyNodeFilter',
    'StrategyNodeIf',
    'StrategyNodeInvocableAction',
    'StrategyNodeInvocableActionArg',
    'StrategyNodeMap',
    'StrategyNodeRecommendationLimit',
    'StrategyNodeRecommendationLoad',
    'StrategyNodeSort',
    'StrategyNodeSortField',
    'StrategyNodeUnion',
    'SubtabComponents',
    'SummaryLayout',
    'SummaryLayoutItem',
    'SynonymDictionary',
    'SynonymGroup',
    'TabLimitConfig',
    'Targets',
    'TopicsForObjects',
    'TransactionSecurityAction',
    'TransactionSecurityNotification',
    'TransactionSecurityPolicy',
    'UiFormulaCriterion',
    'UiFormulaRule',
    'UserProfileSearchScope',
    'UserProvisioningConfig',
    'Users',
    'ValidationRuleTranslation',
    'ValueSet',
    'ValueSetValuesDefinition',
    'ValueTranslation',
    'VendorCallCenterStatusMap',
    'WebLinkTranslation',
    'Workflow',
    'WorkflowActionReference',
    'WorkflowEmailRecipient',
    'WorkflowFlowActionParameter',
    'WorkflowTaskTranslation',
    'WorkflowTimeTrigger',
    'WorkspaceMapping',
];
exports.METADATA_TYPES_WITH_DEPENDENCIES = __spreadArrays([
    'CustomMetadata'
], exports.CUSTOM_OBJECT_FIELDS, exports.WORKFLOW_FIELDS);
exports.EXCLUDED_METADATA_TYPES = __spreadArrays([
    'AssignmentRule',
    'CustomField',
    'CustomIndex',
    'CustomLabel',
    'EscalationRule',
    'FlowDefinition',
    'Settings'
], exports.FOLDER_METADATA_TYPES);
exports.SUPPORTED_METADATA_TYPES = __spreadArrays(exports.METADATA_TYPES_WITHOUT_DEPENDENCIES, exports.METADATA_TYPES_WITH_DEPENDENCIES);
exports.SALESFORCE_METADATA_TYPES = __spreadArrays(exports.SUPPORTED_METADATA_TYPES, exports.EXCLUDED_METADATA_TYPES);
exports.METADATA_TYPE_TO_DEPENDENCIES = {
    CustomMetadata: ['CustomMetadata', 'CustomObject'],
    BusinessProcess: ['CustomObject'],
    CompactLayout: ['CustomObject'],
    FieldSet: ['CustomObject'],
    Index: ['CustomObject'],
    ListView: ['CustomObject'],
    RecordType: ['CustomObject'],
    SharingReason: ['CustomObject'],
    ValidationRule: ['CustomObject'],
    WebLink: ['CustomObject'],
    WorkflowAlert: ['Workflow'],
    WorkflowFieldUpdate: ['Workflow'],
    WorkflowFlowAction: ['Workflow'],
    WorkflowKnowledgePublish: ['Workflow'],
    WorkflowOutboundMessage: ['Workflow'],
    WorkflowRule: ['Workflow'],
    WorkflowTask: ['Workflow'],
};
var isMetadataTypeWithoutDependencies = function (metadataType) { return (exports.METADATA_TYPES_WITHOUT_DEPENDENCIES.includes(metadataType)); };
exports.isMetadataTypeWithoutDependencies = isMetadataTypeWithoutDependencies;
var isMetadataTypeWithDependency = function (metadataType) { return (exports.METADATA_TYPES_WITH_DEPENDENCIES.includes(metadataType)); };
exports.isMetadataTypeWithDependency = isMetadataTypeWithDependency;
var getFetchTargets = function (target) {
    var allTypes = __spreadArrays(target.filter(exports.isMetadataTypeWithoutDependencies));
    var handledTypesWithDependencies = [];
    var typesWithDependencies = target.filter(exports.isMetadataTypeWithDependency);
    while (!lodash_1["default"].isEmpty(typesWithDependencies)) {
        lodash_1["default"](exports.METADATA_TYPE_TO_DEPENDENCIES)
            .pick(typesWithDependencies)
            .values()
            .flatten()
            .forEach(function (metadataType) { return allTypes.push(metadataType); });
        typesWithDependencies.forEach(function (metadataType) { return handledTypesWithDependencies.push(metadataType); });
        typesWithDependencies = allTypes
            .filter(exports.isMetadataTypeWithDependency)
            .filter(function (typeWithDependency) { return !handledTypesWithDependencies.includes(typeWithDependency); });
    }
    return lodash_1["default"](allTypes)
        .uniq()
        .value();
};
exports.getFetchTargets = getFetchTargets;
